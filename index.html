<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æˆ‘çš„è–èª•å¤œæ€éº¼é‚£éº¼ç´¯ (Turboæ¥µé€Ÿå„ªåŒ–ç‰ˆ)</title>

  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

  <style>
    /* å…¨å±€è¨­å®š */
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      text-align: center; 
      background: transparent; 
      color: #fff; 
      margin: 0; 
      overflow: hidden; 
      user-select: none; /* é˜²æ­¢é€£é»é¸å–æ–‡å­— */
      -webkit-user-select: none;
    }

    .container { 
      position: relative; 
      width: 100vw; 
      height: 100vh; 
    }

    video, canvas { 
      position: absolute; 
      top: 0; left: 0; 
      width: 100%; height: 100%; 
      object-fit: cover; 
      transform: scaleX(-1); 
    }

    /* =========================================
       è–èª•å¤œèƒŒæ™¯å ´æ™¯ CSS
       ========================================= */
    .scene-background {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      z-index: -1; 
      overflow: hidden;
      background: #000;
    }

    .night-sky {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 70%;
      background: linear-gradient(to bottom, #020111 10%, #191d3a 50%, #2d3e5e 90%);
    }

    .moon {
      position: absolute;
      top: 50px; right: 50px;
      width: 80px; height: 80px;
      background: #fefcd7;
      border-radius: 50%;
      box-shadow: 0 0 20px #fefcd7, 0 0 50px rgba(254, 252, 215, 0.4);
    }

    .snow-ground {
      position: absolute;
      bottom: 0; left: 0;
      width: 100%; height: 30%;
      background: #fffafa;
      border-top: 5px solid #e3e3e3;
      border-radius: 50% 50% 0 0 / 20px 20px 0 0;
    }

    .snowflake {
      position: absolute;
      top: -10px;
      width: 10px; height: 10px;
      background: white;
      border-radius: 50%;
      opacity: 0.8;
      animation: fall linear infinite;
    }

    @keyframes fall {
      0% { top: -10%; transform: translateX(0); }
      100% { top: 100%; transform: translateX(20px); }
    }

    .snowflake:nth-child(2) { width: 8px; height: 8px; animation-duration: 7s; opacity: 0.6; }
    .snowflake:nth-child(3) { width: 12px; height: 12px; animation-duration: 5s; opacity: 0.9; }
    .snowflake:nth-child(4) { width: 6px; height: 6px; animation-duration: 8s; opacity: 0.5; }
    .snowflake:nth-child(5) { width: 10px; height: 10px; animation-duration: 6s; opacity: 0.7; }
    .snowflake:nth-child(6) { width: 9px; height: 9px; animation-duration: 9s; opacity: 0.8; }

    /* =========================================
       UI ä»‹é¢ CSS
       ========================================= */

    .score-board { 
      position: absolute; 
      top: 80px; 
      left: 50%; 
      transform: translateX(-50%); 
      z-index: 10; 
      background: rgba(0, 0, 0, 0.6); 
      padding: 10px 40px; 
      border-radius: 20px; 
      border: 1px solid rgba(255, 255, 255, 0.3);
      pointer-events: none; 
      transition: all 0.1s ease; /* åŠ å¿«ç‰¹æ•ˆåæ‡‰é€Ÿåº¦ */
      will-change: transform, box-shadow; /* æ•ˆèƒ½å„ªåŒ– */
    }
    #count { font-size: 70px; font-weight: 800; color: #fff; line-height: 1; }
    .count-title { font-size: 14px; color: #ccc; letter-spacing: 2px; }
    #status { margin-top: 5px; font-size: 18px; font-weight: bold; color: #ddd; }

    #start-btn { 
      position: absolute; 
      top: 50%; left: 50%; 
      transform: translate(-50%, -50%); 
      z-index: 50; 
      padding: 25px 50px; 
      font-size: 30px; 
      font-weight: 900;
      background: linear-gradient(135deg, #007bff, #0056b3); 
      color: white; 
      border: 4px solid rgba(255, 255, 255, 0.5); 
      border-radius: 60px; 
      cursor: pointer; 
      box-shadow: 0 0 30px rgba(0, 123, 255, 0.6); 
      white-space: nowrap;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.05); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }

    #reset-btn {
      position: absolute;
      bottom: 100px; right: 20px;
      z-index: 100;
      background: #ff4757;
      color: white;
      border: 2px solid white;
      padding: 15px 30px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 30px;
      cursor: pointer;
      display: none; 
    }
    #reset-btn:active { transform: scale(0.9); }

    .pop-effect { animation: pop 0.1s ease-out; color: #00ff00 !important; }
    @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.4); } 100% { transform: scale(1); } }

    /* Landscape æ‰‹æ©Ÿå„ªåŒ– */
    @media (max-height: 500px) and (orientation: landscape) {
      .score-board { top: 10px; left: 20px; transform: none; padding: 5px 20px; }
      #count { font-size: 40px; }
      .count-title { font-size: 10px; }
      #status { font-size: 14px; margin-top: 0; }
      #start-btn { padding: 15px 30px; font-size: 20px; border-width: 2px; }
      #reset-btn { bottom: auto; top: 10px; right: 20px; padding: 8px 15px; font-size: 14px; }
    }

    /* ç«ç„°ç‰¹æ•ˆ */
    .fire-lv1 { border-color: #ffd700 !important; color: #ffd700 !important; box-shadow: 0 0 15px rgba(255, 215, 0, 0.6), inset 0 0 10px rgba(255, 215, 0, 0.4); animation: burn-pulse 1s infinite alternate; }
    .fire-lv2 { border-color: #ff4500 !important; color: #ff4500 !important; box-shadow: 0 0 30px rgba(255, 69, 0, 0.8), inset 0 0 20px rgba(255, 69, 0, 0.5); animation: burn-pulse 0.4s infinite alternate; }
    .fire-lv3 { border-color: #00ffff !important; color: #00ffff !important; background: rgba(0, 255, 255, 0.1) !important; box-shadow: 0 0 20px #00ffff, 0 0 40px #00ffff, 0 0 60px #fff; animation: burn-max 0.1s infinite; }

    @keyframes burn-pulse { 0% { box-shadow: 0 0 15px currentColor, inset 0 0 5px currentColor; } 100% { box-shadow: 0 0 35px currentColor, inset 0 0 15px currentColor; transform: translateX(-50%) scale(1.05); } }
    @keyframes burn-max { 0% { transform: translateX(-50%) translate(1px, 1px) scale(1.1); } 25% { transform: translateX(-50%) translate(-1px, -2px) scale(1.1); } 50% { transform: translateX(-50%) translate(-2px, 1px) scale(1.1); } 75% { transform: translateX(-50%) translate(2px, 1px) scale(1.1); } 100% { transform: translateX(-50%) translate(-1px, -1px) scale(1.1); } }

    /* Desktop å„ªåŒ– */
    @media (min-width: 1024px) {
      .score-board { top: 60px; padding: 20px 80px; border-width: 3px; background: rgba(0, 0, 0, 0.7); left: 50%; transform: translateX(-50%); }
      #count { font-size: 140px; text-shadow: 0 0 30px currentColor; }
      .count-title { font-size: 20px; letter-spacing: 5px; margin-bottom: 10px; }
      #status { font-size: 24px; }
      .fire-lv1 { box-shadow: 0 0 30px rgba(255, 215, 0, 0.6), inset 0 0 20px rgba(255, 215, 0, 0.4); }
      .fire-lv2 { box-shadow: 0 0 50px rgba(255, 69, 0, 0.8), inset 0 0 30px rgba(255, 69, 0, 0.5); }
      .fire-lv3 { box-shadow: 0 0 40px #00ffff, 0 0 80px #00ffff, 0 0 100px #fff; }
    }
  </style>
</head>

<body>

  <div class="scene-background">
    <div class="night-sky">
      <div class="moon"></div>
      <div class="snowflake" style="left: 10%; animation-delay: 0s;"></div>
      <div class="snowflake" style="left: 30%; animation-delay: 2s;"></div>
      <div class="snowflake" style="left: 50%; animation-delay: 4s;"></div>
      <div class="snowflake" style="left: 70%; animation-delay: 1s;"></div>
      <div class="snowflake" style="left: 90%; animation-delay: 3s;"></div>
    </div>
    <div class="snow-ground"></div>
  </div>

  <div class="container">
    <div class="score-board">
      <div class="count-title">TOTAL HITS</div>
      <div id="count">0</div>
      <div id="status">READY</div>
    </div>

    <div class="video-container">
      <video id="input_video" playsinline style="display:none"></video> <canvas id="output_canvas"></canvas>
    </div>

    <button id="start-btn" onclick="initGame()">ğŸ¥Š é»æ“Šé–‹å§‹ (START)</button>
    <button id="reset-btn" onclick="resetCount()">æ­¸é›¶é‡ç½® (RESET)</button>
  </div>

  <script>
    // --- 0. å°ˆæ¥­ç´šéŸ³æ•ˆç³»çµ± (Web Audio API) ---
    // ä½¿ç”¨ Web Audio API å–ä»£å‚³çµ± <audio> æ¨™ç±¤ï¼Œè§£æ±ºå¿«ç¯€å¥å¡é “å•é¡Œ
    const PUNCH_SOUND_URL = 'punch.mp3'; 
    
    let audioContext = null;
    let punchBuffer = null;

    // è¼‰å…¥ä¸¦è§£ç¢¼éŸ³æ•ˆæª” (åªåŸ·è¡Œä¸€æ¬¡ï¼Œå­˜å…¥è¨˜æ†¶é«”)
    async function loadSound() {
        try {
            // å»ºç«‹éŸ³è¨Šç’°å¢ƒ
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioContext = new AudioContext();
            
            // ä¸‹è¼‰æª”æ¡ˆ
            const response = await fetch(PUNCH_SOUND_URL);
            const arrayBuffer = await response.arrayBuffer();
            
            // è§£ç¢¼æˆæ³¢å½¢æ•¸æ“š
            punchBuffer = await audioContext.decodeAudioData(arrayBuffer);
            console.log("éŸ³æ•ˆè¼‰å…¥å®Œæˆï¼ŒTurbo æ¨¡å¼å°±ç·’");
        } catch (error) {
            console.error("éŸ³æ•ˆè¼‰å…¥å¤±æ•— (å¯èƒ½æ˜¯æª”æ¡ˆè·¯å¾‘éŒ¯èª¤):", error);
            statusElement.innerText = "AUDIO ERROR";
        }
    }

    // æ¥µé€Ÿæ’­æ”¾å‡½å¼ (ç„¡å»¶é²ã€ç„¡ç‰©ä»¶å †ç©)
    function playPunchSound() {
        if (!audioContext || !punchBuffer) return;
        
        // å¦‚æœç€è¦½å™¨æš«åœäº†éŸ³è¨Šç’°å¢ƒï¼Œå˜—è©¦æ¢å¾©
        if (audioContext.state === 'suspended') {
            audioContext.resume();
        }

        // å»ºç«‹ä¸€å€‹è¼•é‡çš„ã€Œè²éŸ³æºã€
        const source = audioContext.createBufferSource();
        source.buffer = punchBuffer;
        source.connect(audioContext.destination);
        source.start(0); // ç«‹å³æ’­æ”¾
        // æ’­æ”¾å®Œç•¢å¾Œï¼Œé€™å€‹ source æœƒè‡ªå‹•è¢«åƒåœ¾å›æ”¶ï¼Œæ¥µåº¦è¼•é‡
    }

    // --- 1. å–å¾—ç¶²é å…ƒç´  ---
    const videoElement = document.getElementById('input_video');
    const canvasElement = document.getElementById('output_canvas');
    const canvasCtx = canvasElement.getContext('2d', { alpha: false }); // å„ªåŒ–ï¼šé—œé–‰é€æ˜åº¦é‹ç®—
    const countElement = document.getElementById('count');
    const scoreBoard = document.querySelector('.score-board'); 
    const statusElement = document.getElementById('status');
    const startBtn = document.getElementById('start-btn'); 
    const resetBtn = document.getElementById('reset-btn'); 

    // --- 2. åƒæ•¸è¨­å®š ---
    const LEFT_CONFIG = { triggerRatio: 0.65, resetRatio: 0.50, visibility: 0.4, cooldownFrames: 5, noseBlock: 0.30 };
    const RIGHT_CONFIG = { triggerRatio: 0.60, resetRatio: 0.45, visibility: 0.3, cooldownFrames: 5, noseBlock: 0.30 };
    const DOMINANCE_BUFFER = -0.05; 
    const MAX_PUNCH_DURATION = 30; 
    const ELEVATION_TOLERANCE = 0.3;

    let count = 0;
    let leftStage = "down", rightStage = "down";
    let leftCooldown = 0, rightCooldown = 0;
    let leftPunchTimer = 0, rightPunchTimer = 0;
    let floatingTexts = []; 

    // --- 3. å·¥å…·å‡½æ•¸ ---
    function calculateDistance(a, b) {
      return Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));
    }

    function drawVisualText(ctx, text, visualX, visualY, color, fontSize = "24px") {
      ctx.save();
      // å› ç‚º canvas å·²ç¶“æ°´å¹³ç¿»è½‰ï¼Œæˆ‘å€‘ä¸éœ€è¦åœ¨é€™è£¡å†ç¿»è½‰ï¼Œç›´æ¥è¨ˆç®—æ­£ç¢ºä½ç½®å³å¯
      // æ³¨æ„ï¼šé€™è£¡çš„ visualX æ˜¯åŸºæ–¼ã€Œå·²ç¿»è½‰ã€çš„ç•«å¸ƒ
      ctx.scale(-1, 1); 
      ctx.font = `bold ${fontSize} Arial`;
      ctx.fillStyle = color;
      // å› ç‚º scale(-1, 1)ï¼ŒX åº§æ¨™è¦è®Šè² çš„
      ctx.fillText(text, -visualX, visualY); 
      ctx.restore();
    }

    function spawnFloatingText(x, y, text, color) {
        // é™åˆ¶ç•«é¢ä¸Šçš„æ–‡å­—æ•¸é‡ï¼Œé¿å…è¨˜æ†¶é«”æš´æ¼²
        if(floatingTexts.length > 20) floatingTexts.shift();
        floatingTexts.push({ x, y, text, color, life: 15, offsetY: 0 });
    }

    function updateFireEffect(currentCount) {
      if (!scoreBoard) return;
      // åªæœ‰åœ¨ç­‰ç´šè®ŠåŒ–æ™‚æ‰æ“ä½œ classï¼Œæ¸›å°‘ DOM æ“ä½œ
      const currentClass = scoreBoard.classList.contains('fire-lv3') ? 3 : 
                           scoreBoard.classList.contains('fire-lv2') ? 2 :
                           scoreBoard.classList.contains('fire-lv1') ? 1 : 0;
      
      let targetClass = 0;
      if (currentCount >= 100) targetClass = 3;
      else if (currentCount >= 80) targetClass = 2;
      else if (currentCount >= 50) targetClass = 1;

      if (currentClass !== targetClass) {
          scoreBoard.classList.remove('fire-lv1', 'fire-lv2', 'fire-lv3');
          if (targetClass === 3) scoreBoard.classList.add('fire-lv3');
          if (targetClass === 2) scoreBoard.classList.add('fire-lv2');
          if (targetClass === 1) scoreBoard.classList.add('fire-lv1');
      }
    }

    function triggerScoreBoardEffect() {
      countElement.classList.remove('pop-effect'); 
      void countElement.offsetWidth; 
      countElement.classList.add('pop-effect'); 
      updateFireEffect(count);
    }

    window.resetCount = function() {
      count = 0; 
      countElement.innerText = count; 
      floatingTexts = []; 
      if (scoreBoard) scoreBoard.classList.remove('fire-lv1', 'fire-lv2', 'fire-lv3');
      statusElement.innerText = "RESET OK"; 
      statusElement.style.color = "white";
    }

    // --- 4. æ ¸å¿ƒé‚è¼¯ (æ¸²æŸ“èˆ‡è¨ˆç®—) ---
    function onResults(results) {
      // å„ªåŒ– 1: é–å®š Canvas è§£æåº¦
      // å¾ˆå¤šæ‰‹æ©Ÿæ”å½±æ©Ÿæ˜¯ 1080p æˆ– 4Kï¼Œæ¯ç§’ç•« 30 æ¬¡æœƒéå¸¸å¡
      // æˆ‘å€‘å¼·åˆ¶å°‡å…§éƒ¨é‹ç®—è§£æåº¦é™åˆ° 720p å¯¬åº¦ï¼Œä½† CSS æœƒè®“å®ƒçœ‹èµ·ä¾†æ˜¯å…¨è¢å¹•
      const targetWidth = Math.min(window.innerWidth, 1280); 
      const aspectRatio = videoElement.videoHeight / videoElement.videoWidth || 0.75;
      const targetHeight = targetWidth * aspectRatio;

      // åªæœ‰ç•¶å°ºå¯¸æ”¹è®Šæ™‚æ‰é‡æ–°è¨­å®šï¼Œé¿å…é »ç¹ layout thrashing
      if (canvasElement.width !== targetWidth) {
          canvasElement.width = targetWidth;
          canvasElement.height = targetHeight;
      }

      const cw = canvasElement.width;
      const ch = canvasElement.height;

      // ç¹ªè£½å½±åƒ
      canvasCtx.save();
      canvasCtx.clearRect(0, 0, cw, ch);
      canvasCtx.drawImage(results.image, 0, 0, cw, ch);

      // è™•ç†æµ®å‹•æ–‡å­—
      for (let i = floatingTexts.length - 1; i >= 0; i--) {
        let ft = floatingTexts[i];
        ft.life--; ft.offsetY -= 5;
        // è¦–è¦ºä¿®æ­£ï¼šå› ç‚ºç•«å¸ƒç¿»è½‰ï¼Œè¨ˆç®—è¦–è¦º X
        const visualX = cw - (ft.x * cw); 
        drawVisualText(canvasCtx, ft.text, visualX, (ft.y * ch) + ft.offsetY, ft.color, "60px");
        if (ft.life <= 0) floatingTexts.splice(i, 1);
      }

      // è™•ç†å†·å»
      if (leftCooldown > 0) leftCooldown--;
      if (rightCooldown > 0) rightCooldown--;

      // è™•ç†å‹•ä½œé€¾æ™‚
      if (leftStage === "punch" && ++leftPunchTimer > MAX_PUNCH_DURATION) { leftStage = "down"; leftPunchTimer = 0; }
      else if (leftStage !== "punch") leftPunchTimer = 0;

      if (rightStage === "punch" && ++rightPunchTimer > MAX_PUNCH_DURATION) { rightStage = "down"; rightPunchTimer = 0; }
      else if (rightStage !== "punch") rightPunchTimer = 0;

      // éª¨æ¶åµæ¸¬
      if (results.poseLandmarks) {
        // ç°¡å–®ç¹ªè£½éª¨æ¶ï¼Œé™ä½ç·šæ¢è¤‡é›œåº¦
        drawConnectors(canvasCtx, results.poseLandmarks, POSE_CONNECTIONS, {color: 'rgba(255, 255, 255, 0.2)', lineWidth: 1});
        
        const lm = results.poseLandmarks;
        const nose = lm[0];
        const leftShoulder = lm[11], rightShoulder = lm[12];
        const leftElbow = lm[13], rightElbow = lm[14];
        const leftWrist = lm[15], rightWrist = lm[16];

        if (nose && leftShoulder && rightShoulder) {
          const shoulderWidth = calculateDistance(leftShoulder, rightShoulder);
          const stableScale = shoulderWidth * 2.0; // ç°¡åŒ–è¨ˆç®—

          // ç¹ªè£½ç›®æ¨™é»
          const targetX = (nose.x - (stableScale * 0.6)) * cw; // èª¿æ•´ä½ç½®åƒæ•¸
          const targetY = nose.y * ch;

          canvasCtx.beginPath();
          canvasCtx.strokeStyle = "#00FF00"; 
          canvasCtx.lineWidth = 4;
          canvasCtx.arc(targetX, targetY, 20, 0, 2 * Math.PI); 
          canvasCtx.stroke();

          // åˆ¤æ–·æ…£ç”¨æ‰‹ & è™•ç†å‡ºæ‹³
          // é€™è£¡ä¸åšéå¤šè¦–è¦ºæ–‡å­—ç¹ªè£½ï¼Œç¯€çœæ•ˆèƒ½
          
          if (leftElbow && leftWrist && leftWrist.visibility > LEFT_CONFIG.visibility) {
            leftStage = processHand(leftShoulder, leftWrist, stableScale, leftStage, "L", nose, leftCooldown, LEFT_CONFIG);
          }
          if (rightElbow && rightWrist && rightWrist.visibility > RIGHT_CONFIG.visibility) {
            rightStage = processHand(rightShoulder, rightWrist, stableScale, rightStage, "R", nose, rightCooldown, RIGHT_CONFIG);
          }
        }
      }
      canvasCtx.restore();
    }

    function processHand(shoulder, wrist, scale, currentStage, label, nose, currentCooldown, config) {
      const wristDist = calculateDistance(shoulder, wrist);
      const ratio = wristDist / scale;
      const noseDist = calculateDistance(wrist, nose);
      const noseRatio = noseDist / scale;

      let nextStage = currentStage;
      const isHighEnough = wrist.y < (shoulder.y + ELEVATION_TOLERANCE);

      if (currentStage === "down") {
        if (currentCooldown === 0 && ratio > config.triggerRatio && noseRatio > config.noseBlock && isHighEnough) {
            nextStage = "punch";
        }
      }
      else if (currentStage === "punch") {
        if (ratio < config.triggerRatio) {
          nextStage = "retract";
          
          // æ“Šä¸­åˆ¤å®šï¼
          count++;
          countElement.innerText = count;
          playPunchSound(); // Web Audio API æ¥µé€Ÿæ’­æ”¾
          triggerScoreBoardEffect();

          if (label === "L") leftCooldown = config.cooldownFrames;
          else rightCooldown = config.cooldownFrames;

          const color = label === "L" ? "#00FFFF" : "#FFA500"; 
          // å‚³å…¥æ­£è¦åŒ–åº§æ¨™ (0~1)ï¼Œåœ¨ draw æ™‚å†ä¹˜ä¸Šå¯¬é«˜
          spawnFloatingText(wrist.x, wrist.y, "+1", color);
          
          // æ¸›å°‘ DOM æ“ä½œé »ç‡ï¼Œåªæœ‰ç‹€æ…‹æ”¹è®Šæ™‚æ‰å¯«å…¥
          if (statusElement.innerText !== (label === "L" ? "LEFT HIT!" : "RIGHT HIT!")) {
             statusElement.innerText = label === "L" ? "LEFT HIT!" : "RIGHT HIT!";
             statusElement.style.color = color;
          }
        }
      }
      else if (currentStage === "retract") {
        if (ratio < config.resetRatio) nextStage = "down"; 
        else if (ratio > config.triggerRatio && currentCooldown === 0) nextStage = "punch";
      }

      return nextStage;
    }

    // --- åˆå§‹åŒ– ---
    const pose = new Pose({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`});
    // modelComplexity: 0 (é€Ÿåº¦æœ€å¿«), 1 (é è¨­), 2 (æœ€ç²¾æº–ä½†æ…¢)
    pose.setOptions({ modelComplexity: 0, smoothLandmarks: true, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5 });
    pose.onResults(onResults);

    // --- å•Ÿå‹•å‡½æ•¸ ---
    window.initGame = async function() {
      // 1. åˆå§‹åŒ–éŸ³æ•ˆç³»çµ± (å¿…é ˆåœ¨ä½¿ç”¨è€…é»æ“Šå¾Œè§¸ç™¼)
      await loadSound();
      
      // 2. ç¢ºä¿éŸ³è¨Šç’°å¢ƒé‹ä½œ (è§£é– iOS Safari)
      if (audioContext && audioContext.state === 'suspended') {
          await audioContext.resume();
      }

      // 3. å•Ÿå‹•æ”å½±æ©Ÿ
      const camera = new Camera(videoElement, {
        onFrame: async () => { await pose.send({image: videoElement}); },
        width: 1280, height: 720 // é™åˆ¶æ”å½±æ©Ÿè¼¸å…¥è§£æåº¦ï¼Œä¸éœ€ 4K
      });
      await camera.start();
      
      startBtn.style.display = 'none'; 
      resetBtn.style.display = 'block';
    }
  </script>
</body>
</html>
